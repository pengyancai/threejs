/**
 * @author mrdoob / http://mrdoob.com/
 * @author alteredq / http://alteredqualia.com/
 * modified @pailhead
 */


 THREE.PAILHEADLoader=function(e){THREE.Loader.call(this,e);this.withCredentials=false;this.loadedItems=0;this.totalItems=0};THREE.PAILHEADLoader.prototype=Object.create(THREE.Loader.prototype);THREE.PAILHEADLoader.prototype.load=function(e,t,n,r){var i=this;i.totalItems++;n=n&&typeof n==="string"?n:this.extractUrlBase(e);console.log(i.totalItems);this.loadAjaxJSON(this,e,t,n,false)};THREE.PAILHEADLoader.prototype.loadAjaxJSON=function(e,t,n,r,i){var s=new XMLHttpRequest;var o=0;s.onreadystatechange=function(){if(s.readyState===s.DONE){if(s.status===200||s.status===0){if(s.responseText){var u=JSON.parse(s.responseText);var a=e.parse(u,r);n(a.geometry);e.loadedItems++;e.onLoadComplete();var f=s.getResponseHeader("Content-Length");var l=12;while(f.length<l){f="."+f}var c=29;var h=t;while(h.length<c){h="."+h}console.log("LOADED MODEL"+h);console.log("MODEL SIZE............."+f+" BYTES");console.log("MODEL.........................."+e.loadedItems+" OUT OF "+e.totalItems);console.log(e)}else{console.warn("THREE.JSONLoader: ["+t+"] seems to be unreachable or file there is empty")}}else{console.error("THREE.JSONLoader: Couldn't load ["+t+"] ["+s.status+"]")}}else if(s.readyState===s.LOADING){if(i){if(o===0){o=s.getResponseHeader("Content-Length")}i({total:o,loaded:s.responseText.length})}}else if(s.readyState===s.HEADERS_RECEIVED){var c=30;var h=t;while(h.length<c){h=h+"."}c=11;var p=s.getResponseHeader("Content-Length");while(p.length<c){p="."+p}console.log(h+p);if(i!==undefined){o=s.getResponseHeader("Content-Length")}}else if(s.readyState==s.UNSENT){console.log("unsent")}};s.open("GET",t,true);s.withCredentials=this.withCredentials;s.send(null)};THREE.PAILHEADLoader.prototype.parse=function(e,t){function s(t){var n=e.vertices,i=e.PH_FaceIndex,s=e.PH_UVindex,o=e.PH_customIndex,u=e.PH_tangent,a=e.PH_binormal,f=e.PH_normal;PH_UVs=e.uvs[0];var l=0;var c=0;var h=n.length;while(c<h){vertex=new THREE.Vector3;vertex.x=n[c++]*t;vertex.y=n[c++]*t;vertex.z=n[c++]*t;r.vertices.push(vertex)}var p=0;while(p<i.length){var d=new THREE.Face3;d.materialIndex=0;d.a=i[p++];d.b=i[p++];d.c=i[p++];r.faces.push(d)}var v=r.faces.length;r.faceVertexUvs[0]=[];var m;for(m=0;m<v;m++){r.faceVertexUvs[0][m]=[];for(var g=0;g<3;g++){var y=s[m*3+g];var b=PH_UVs[y*2];var w=PH_UVs[y*2+1];var E=new THREE.Vector2(b,w);r.faceVertexUvs[0][m].push(E)}}for(m=0;m<v;m++){var S=r.faces[m];S.vertexBinormals=[];for(var g=0;g<3;g++){var x=o[m*3+g];x*=3;var T=new THREE.Vector3(f[x],f[x+1],f[x+2]);S.vertexNormals.push(T);var N=new THREE.Vector3(u[x],u[x+1],u[x+2]);S.vertexTangents.push(N);var C=new THREE.Vector3(a[x],a[x+1],a[x+2]);S.vertexBinormals.push(C)}}}var n=this,r=new THREE.Geometry,i=e.scale!==undefined?1/e.scale:1;s(i);r.computeCentroids();r.computeFaceNormals();r.computeBoundingSphere();r.hasTangents=true;r.hasPHbitangents=true;if(e.materials===undefined){return{geometry:r}}else{console.log("CATASTROPHIQUE FAILURE!!!")}}